# JavaScript 中的执行上下文和执行栈

## 一、执行上下文的概念

执行上下文是 JavaScript 代码执行时的环境，它包含了代码执行所需的所有信息。每当函数被调用或全局代码被执行时，都会创建一个新的执行上下文。执行上下文主要分为两种，全局执行上下文（GEC，Global Execution Context）和函数执行上下文（FEC，Function Execution Context）。另外，还包含 eval 上下文，但是目前为止，eval 在 JavaScript 中已经很少使用

全局执行上下文是最基础的，也是默认的上下文。全局执行上下文只有一个，代码在运行时首先进入全局执行上下文，浏览器的 window 对象，就是定义在全局执行上下文中。

函数执行上下文是函数执行时创建的上下文，

执行上下文在创建过程中，主要分为两个阶段：创建阶段和执行阶段。

在创建阶段，执行上下文会同一个执行上下文对象进行关联。执行上下文对象中存储着执行上下文运行时的一些相关数据。

创建过程包含三个阶段。

1. 变量对象的创建。
2. 创建作用域链。
3. this 绑定。

下面进行详细说明。

## 二、创建阶段

### 2.1 创建变量对象










## 三、执行阶段

执行阶段，在执行上下文创建阶段之后开始。在这个阶段，会进行执行代码、变量赋值以及函数调用。

每个执行上下文由以下三个部分组成：
- **变量对象（Variable Object, VO）**：存储变量、函数声明和函数参数。
- **作用域链（Scope Chain）**：包含当前执行上下文的变量对象及其父级上下文的变量对象，形成一个作用域链，用于变量查找。
- **this 绑定**：确定在当前执行上下文中 `this` 指向的对象。

#### 4. 创建过程
执行上下文的创建分为两个阶段：创建阶段和执行阶段。

##### a. 创建阶段
- **建立变量对象**：创建变量对象，存储函数参数、变量和函数声明。
- **建立作用域链**：创建作用域链，将变量对象加入作用域链。
- **确定 this 指向**：确定 this 的指向。

##### b. 执行阶段
- **变量赋值**：变量和函数参数赋值。
- **执行代码**：执行代码块中的具体逻辑。

## 四、执行栈

执行栈（也称调用栈）是一个堆栈结构，用于管理执行上下文的执行顺序。每当一个新的执行上下文被创建时，它会被推入执行栈的栈顶。当前函数执行完毕后，该执行上下文会从栈顶弹出。

## 五、参考

- Victor Ikechukwu，[JavaScript Execution Context – How JS Works Behind The Scenes](https://www.freecodecamp.org/news/execution-context-how-javascript-works-behind-the-scenes/)
